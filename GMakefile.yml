config:
  default: all

init: |
  @cmd get_info

hello: |
  @wait Please Enter Password pass
  @echo {{.pass}}
  @echo 114

all: |
  @cmd clean
  go mod tidy
  @mkdir bin
  @cmd linux
  @cmd windows
  @echo Done!

build: |
  @env CGO_ENABLED 0
  @env GOARCH amd64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}'  -X 'main.SoftVersionCode={{.version_code}}'" -o ./example/gmake2.exe

clean: |
  @rm bin

linux: |
  @env GOOS linux
  @env CGO_ENABLED 0
  @env GOARCH amd64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}' -X 'main.SoftVersionCode={{.version_code}}'" -o ./bin/gmake2_Linux_amd64
  @env GOARCH arm64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}' -X 'main.SoftVersionCode={{.version_code}}'" -o ./bin/gmake2_Linux_aarch64
  @env GOARCH mips64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}' -X 'main.SoftVersionCode={{.version_code}}'" -o ./bin/gmake2_Linux_mips64

windows: |
  @env GOOS windows
  @env CGO_ENABLED 0
  @env GOARCH amd64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}' -X 'main.SoftVersionCode={{.version_code}}'" -o ./bin/gmake2_Windows_amd64.exe
  @env GOARCH arm64
  go build -ldflags "-s -w -X 'main.SoftBuildTime={{.time.utc}}' -X 'main.SoftCommit={{.commit}}' -X 'main.SoftVersion={{.version}}' -X 'main.SoftVersionCode={{.version_code}}'" -o ./bin/gmake2_Windows_aarch64.exe

get_info: |
  @echo Get version info...
  @json https://1cp.org/gmake2.raw gmake2_version
  @json parse gmake2_version version version
  @json parse gmake2_version version_code version_code
  @val commit git log --pretty=format:'%h' -1